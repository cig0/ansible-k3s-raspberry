---
- name: Disable swap for current session
  command: swapoff -a

- name: Disable swap permanently, persist reboots
  replace:
    path: /etc/fstab
    regexp: '^(\s*)([^#\n]+\s+)(\w+\s+)swap(\s+.*)$'
    replace: '#\1\2\3swap\4'
    backup: yes

- name: Mount /var/log and /var/tmp as tmpfs
  blockinfile:
    path: /etc/fstab
    state: present
    block: |
      tmpfs /var/log tmpfs defaults 0 0
      tmpfs /var/tmp tmpfs nodev,nosuid,size=50M 0 0
  notify: restart
  when: "'master' not in group_names"
